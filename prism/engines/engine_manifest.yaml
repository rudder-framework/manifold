# PRISM Engine Manifest
# Maps typology classifications to engine selection
# All engines must be scale-invariant

version: "1.0"

# ============================================================
# CORE ENGINES - Always computed for active signals
# ============================================================
core:
  - kurtosis
  - skewness
  - crest_factor

# ============================================================
# ENGINES BY SIGNAL TYPE
# ============================================================
signal_type:
  SMOOTH:
    - rolling_kurtosis
    - rolling_entropy
    - rolling_crest_factor
    - rolling_skewness

  NOISY:
    - kurtosis      # larger window handles noise
    - entropy
    - crest_factor

  IMPULSIVE:
    - kurtosis
    - crest_factor
    - peak_ratio
    - rolling_kurtosis

  MIXED:
    - kurtosis
    - skewness
    - entropy
    - crest_factor

# ============================================================
# ENGINES BY PERIODICITY
# ============================================================
periodicity:
  PERIODIC:
    - harmonics_ratio     # 2x/1x, 3x/1x
    - band_ratios         # low/mid/high relative
    - spectral_centroid   # normalized
    - spectral_entropy

  QUASI_PERIODIC:
    - band_ratios
    - spectral_entropy

  APERIODIC:
    - entropy
    - hurst

# ============================================================
# ENGINES BY TAIL BEHAVIOR
# ============================================================
tail_type:
  HEAVY_TAILS:
    - kurtosis      # emphasize
    - crest_factor  # emphasize
    - peak_ratio

  MODERATE_TAILS:
    - kurtosis
    - crest_factor

  LIGHT_TAILS:
    - entropy
    - skewness

  NORMAL_TAILS: []  # core is enough

# ============================================================
# ENGINES BY STATIONARITY
# ============================================================
stationarity:
  STATIONARY:
    # Global stats OK
    - kurtosis
    - entropy
    - hurst

  NON_STATIONARY:
    # Rolling only - global meaningless
    - rolling_kurtosis
    - rolling_entropy
    - rolling_crest_factor
    - rolling_skewness

  VARIANCE_INCREASING:
    - rolling_kurtosis
    - rolling_entropy
    - rate_of_change_ratio

  VARIANCE_DECREASING:
    - rolling_kurtosis
    - rolling_entropy

# ============================================================
# ENGINES BY MEMORY
# ============================================================
memory:
  TRENDING:     # memory_proxy < 0.5 or hurst > 0.6
    - hurst
    - rate_of_change_ratio

  REVERTING:    # hurst < 0.4
    - hurst
    - mean_deviation_ratio

  RANDOM: []    # core is enough

# ============================================================
# WINDOW RULES
# ============================================================
window:
  # Based on autocorr_1 (smoothness)
  rules:
    - smoothness: ">0.95"
      window: 10
    - smoothness: ">0.90"
      window: 15
    - smoothness: ">0.80"
      window: 20
    - smoothness: ">0.60"
      window: 30
    - smoothness: ">0.40"
      window: 50
    - smoothness: "<=0.40"
      window: 100

  # Global window = min across active signals (conservative)
  global_strategy: "min"

# ============================================================
# SKIP RULES
# ============================================================
skip:
  - is_constant: true
  - signal_std: "<0.001"
  - n_samples: "<100"

# ============================================================
# ENGINE DEFINITIONS (for validation)
# ============================================================
engines:
  kurtosis:
    scale_invariant: true
    requires_window: false

  skewness:
    scale_invariant: true
    requires_window: false

  crest_factor:
    scale_invariant: true
    requires_window: false
    description: "max / rms"

  peak_ratio:
    scale_invariant: true
    requires_window: false
    description: "max / mean(abs)"

  entropy:
    scale_invariant: true
    requires_window: false

  spectral_entropy:
    scale_invariant: true
    requires_window: false

  hurst:
    scale_invariant: true
    requires_window: false

  rate_of_change_ratio:
    scale_invariant: true
    requires_window: false
    description: "normalized derivative"

  harmonics_ratio:
    scale_invariant: true
    requires_window: false
    description: "2x/1x, 3x/1x ratios"

  band_ratios:
    scale_invariant: true
    requires_window: false
    description: "low/total, mid/total, high/total"

  spectral_centroid:
    scale_invariant: true
    requires_window: false
    description: "normalized by Nyquist"

  rolling_kurtosis:
    scale_invariant: true
    requires_window: true

  rolling_skewness:
    scale_invariant: true
    requires_window: true

  rolling_entropy:
    scale_invariant: true
    requires_window: true

  rolling_crest_factor:
    scale_invariant: true
    requires_window: true

# ============================================================
# DEPRECATED / DO NOT USE (scale-dependent)
# ============================================================
deprecated:
  - rms                 # absolute
  - peak                # absolute
  - total_power         # absolute
  - harmonic_2x         # absolute (use harmonics_ratio)
  - harmonic_3x         # absolute (use harmonics_ratio)
  - rolling_rms         # absolute
  - rolling_mean        # absolute
  - rolling_std         # absolute
  - rolling_range       # absolute
  - envelope            # absolute
  - rolling_envelope    # absolute
